<!DOCTYPE html>
<html>
<head>
    <title>{{ project.name }}</title>
    <style>
        .kanban-board {
            display: flex;
            justify-content: space-around;
        }
        .kanban-column {
            width: 30%;
            background-color: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
        }
        .kanban-column h2 {
            text-align: center;
        }
        .kanban-card {
            background-color: #fff;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .subtask {
            margin-left: 20px;
            font-style: italic;
            color: gray;
        }
        .subtask-of-subtask {
            margin-left: 40px;
            font-style: italic;
            color: darkgray;
        }
        .priority-low { color: green; }
        .priority-medium { color: orange; }
        .priority-high { color: red; }
    </style>
</head>
<body>
    <h1>{{ project.name }}</h1>
    <p>{{ project.description }}</p>
    <p>Owner: {{ project.owner.username }}</p>
    <p>Customer: {{ project.customer.username }}</p>
    <p>Completion Rate: {{ completion_rate }}%</p>

    <button onclick="window.location.href='{% url 'home' %}'">Go Back</button>

    <form method="get" action="{% url 'project_detail' project.id %}">
        <input type="text" name="search" placeholder="Search tasks by ID or name" value="{{ request.GET.search }}">
        <button type="submit">Search</button>
    </form>

    <div class="kanban-board">
        <div class="kanban-column">
            <h2>To Do</h2>
            {% for task in tasks %}
                {% if task.status == 'Pending' %}
                    <div class="kanban-card">
                        <p><a href="{% url 'task_detail' task.id %}">{{ task.subject }}</a> (ID: {{ task.id }})</p>
                        <p>Assigned User: {{ task.assigned_user.username }}</p>
                        <p class="priority-{{ task.priority|lower }}">Priority: {{ task.priority }}</p>
                        {% for subtask in task.subtasks.all %}
                            <div class="subtask">
                                <p><a href="{% url 'task_detail' subtask.id %}">{{ subtask.subject }}</a> (ID: {{ subtask.id }})</p>
                                <p>Assigned User: {{ subtask.assigned_user.username }}</p>
                                {% for subsubtask in subtask.subtasks.all %}
                                    <div class="subtask-of-subtask">
                                        <p><a href="{% url 'task_detail' subsubtask.id %}">{{ subsubtask.subject }}</a> (ID: {{ subsubtask.id }})</p>
                                        <p>Assigned User: {{ subsubtask.assigned_user.username }}</p>
                                        <p><a href="{% url 'edit_task' project.id subsubtask.id %}">Edit Subtask of Subtask</a></p>
                                        <p><a href="{% url 'delete_task' project.id subsubtask.id %}">Delete Subtask of Subtask</a></p>
                                    </div>
                                {% endfor %}
                                <p><a href="{% url 'edit_task' project.id subtask.id %}">Edit Subtask</a></p>
                                <p><a href="{% url 'delete_task' project.id subtask.id %}">Delete Subtask</a></p>
                            </div>
                        {% endfor %}
                        <p><a href="{% url 'edit_task' project.id task.id %}">Edit Task</a></p>
                        <p><a href="{% url 'delete_task' project.id task.id %}">Delete Task</a></p>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
        <div class="kanban-column">
            <h2>In Progress</h2>
            {% for task in tasks %}
                {% if task.status == 'In Progress' %}
                    <div class="kanban-card">
                        <p><a href="{% url 'task_detail' task.id %}">{{ task.subject }}</a> (ID: {{ task.id }})</p>
                        <p>Assigned User: {{ task.assigned_user.username }}</p>
                        <p class="priority-{{ task.priority|lower }}">Priority: {{ task.priority }}</p>
                        {% for subtask in task.subtasks.all %}
                            <div class="subtask">
                                <p><a href="{% url 'task_detail' subtask.id %}">{{ subtask.subject }}</a> (ID: {{ subtask.id }})</p>
                                <p>Assigned User: {{ subtask.assigned_user.username }}</p>
                                {% for subsubtask in subtask.subtasks.all %}
                                    <div class="subtask-of-subtask">
                                        <p><a href="{% url 'task_detail' subsubtask.id %}">{{ subsubtask.subject }}</a> (ID: {{ subsubtask.id }})</p>
                                        <p>Assigned User: {{ subsubtask.assigned_user.username }}</p>
                                        <p><a href="{% url 'edit_task' project.id subsubtask.id %}">Edit Subtask of Subtask</a></p>
                                        <p><a href="{% url 'delete_task' project.id subsubtask.id %}">Delete Subtask of Subtask</a></p>
                                    </div>
                                {% endfor %}
                                <p><a href="{% url 'edit_task' project.id subtask.id %}">Edit Subtask</a></p>
                                <p><a href="{% url 'delete_task' project.id subtask.id %}">Delete Subtask</a></p>
                            </div>
                        {% endfor %}
                        <p><a href="{% url 'edit_task' project.id task.id %}">Edit Task</a></p>
                        <p><a href="{% url 'delete_task' project.id task.id %}">Delete Task</a></p>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
        <div class="kanban-column">
            <h2>Completed</h2>
            {% for task in tasks %}
                {% if task.status == 'Completed' %}
                    <div class="kanban-card">
                        <p><a href="{% url 'task_detail' task.id %}">{{ task.subject }}</a> (ID: {{ task.id }})</p>
                        <p>Assigned User: {{ task.assigned_user.username }}</p>
                        <p class="priority-{{ task.priority|lower }}">Priority: {{ task.priority }}</p>
                        {% for subtask in task.subtasks.all %}
                            <div class="subtask">
                                <p><a href="{% url 'task_detail' subtask.id %}">{{ subtask.subject }}</a> (ID: {{ subtask.id }})</p>
                                <p>Assigned User: {{ subtask.assigned_user.username }}</p>
                                {% for subsubtask in subtask.subtasks.all %}
                                    <div class="subtask-of-subtask">
                                        <p><a href="{% url 'task_detail' subsubtask.id %}">{{ subsubtask.subject }}</a> (ID: {{ subsubtask.id }})</p>
                                        <p>Assigned User: {{ subsubtask.assigned_user.username }}</p>
                                        <p><a href="{% url 'edit_task' project.id subsubtask.id %}">Edit Subtask of Subtask</a></p>
                                        <p><a href="{% url 'delete_task' project.id subsubtask.id %}">Delete Subtask of Subtask</a></p>
                                    </div>
                                {% endfor %}
                                <p><a href="{% url 'edit_task' project.id subtask.id %}">Edit Subtask</a></p>
                                <p><a href="{% url 'delete_task' project.id subtask.id %}">Delete Subtask</a></p>
                            </div>
                        {% endfor %}
                        <p><a href="{% url 'edit_task' project.id task.id %}">Edit Task</a></p>
                        <p><a href="{% url 'delete_task' project.id task.id %}">Delete Task</a></p>
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>

    {% if request.user.is_superuser or request.user == project.owner %}
        <h2><a href="{% url 'add_task' project.id %}">Add New Task</a></h2>
    {% endif %}
</body>
</html>